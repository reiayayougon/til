### システム起動時においてのカーネルの説明

・高度にハードウエアを認識・制御し、ルートファイルシステムのマウントなど様々な初期化処理を行う
・/sbin/initを起動する

解説
カーネルは起動されると、高度にハードウエアを認識・制御し、ルートファイルシステムのマウントなど様々な初期化処理を行う。ブートローダーはカーネルと初期RAMディスク(initramfs)の内容をメモリに展開し、カーネルはメモリ上に展開された初期RAMディスク内の、ファイルシステムへアクセスするために必要なドライバやスクリプトを使用してルートファイルシステムをマウントする。その後initという特別な最初のプロセスをルートファイルシステムから起動する。
SysVinitと呼ばれる従来のinitプログラムを採用しているシステムでは、initプロセスとして「/sbin/init」が起動される。なお、カーネルはブートローダーの次に起動される。

ブートローダーとは、コンピュータを起動したときに呼び出されて、OSとかを動かすプログラムのこと。

電源投入→BIOS起動→ブートローダー起動→OS開始
BIOS、ブートローダ、カーネル、initの順

BIOSはパソコンの電源が入って最初に動く、主にハードウエアを制御するプログラム。
一般的にBIOSは「マザーボード」と呼ばれる、パソコンの中にある部品にくっついている。
電源が入ると、マザーボードに電源が流れる。マザーボードに電源が流れると、BIOSが起動。
そのBIOSは、ハードディスクを動かしたりキーボーに準備をさせる。OSが動くのはその後。

復習
コンピュータの電源を入れると、まずBIOSが起動し、記憶装置(HDD)などに関しての最低限の認識をして起動デバイスの優先順位決定。その後、優先順位に従って各デバイスの先頭セクタにあるMBR(ブート用の特殊領域。ブートローダが格納されている)を読み込み、得られたブートローダに制御を移す。ブートローダが得られない場合は次のデバイスのMBRを読み込む。
### カーネルのログの記録

カーネルのログの記録ファイル
```
/var/log/message
```

### 再起動コマンド
「Rwbooting in 10 minutes」というメッセージ表示して23:00に再起動するコマンド
```
shutdown -r 23:00 "Rebooting in 10 minutes"
shutdown -r +10 "Rebooting in 10 minutes"
```

### /etc/inittab

システムの初期化トランレベルの設定に関する情報を保持。initシステムを使用してるシステムで見られるファイル。
簡単にいうと、システムの起動とランレベルの管理に関する設定を保持するファイルであり、システムの初期化や各ランレベルでの挙動を制御するための重要なファイル。


ランレベルの設定：ランレベルは、システムが動作している状態を示すもの。通常、マルチユーザモードやシングルユーザモードなどがある。異なるランレベルで実行されるプロセスやサービスの設定が含まれている。

起動時のジョブスケジューリング：「/etc/inittab」はシステムが起動したときに実行されるジョブ(タスクやプロセス)を定義。これにより、システムが起動したときにに特定の処理を実行できる。

コンソール制御：ユーザが物理的なコンソールや端末を使用する際の設定も含まれる。ログインプロントの表示やシャットダウンの制御などが該当する。

SysVinitとは/etc/inittabを使用する伝統的なinitシステムの一つ
sustemdとはinitシステム。/etc/inittabを使用せず、独自の仕組みや設定ファイルを使用している。systemdはSysVinitシステムの代替として開発され多くのディストビューションで採用されている。
Upstartもinitシステム。/etc/inittabを使用せず独自の設定やジョブ定義を持っている。

### CPUに関する情報

CPUに関する情報を確認できる
```
/proc/cpuinfo
```

解説
/procディレクトリはプロセス、ハードウエア及びシステムリソースなどの情報を扱うための仮想的なファイルシステム。そのため、ハードディスク上にファイルは存在せず、システムが起動する際にメモリ上に作成される。
/procディレクトリ配下に格納されているファイルの多くはASCIIテキスト形式なので、catコマンドなどで内容が確認できる。以下のコマンドでも効率的に確認できる。
```
lspci  #PCIデバイスに関する情報

lsmod  #ロードされているカーネルモジュールに関する情報表示

lsusb  #USBデバイスに関する情報を表示
```

### systemd

systemdはSysVinitを置き換える新しいinitの仕組み。
systemdで扱う処理はUnitという単位で管理。Unitは設定ファイルであり、Unitの設定に従って、systemd自体が処理を実行する。SysVinitのようにスクリプトを実行する訳ではない。
Unitには各機能ごとに拡張子が割り当てられおり、拡張子を見ることでどういった機能のためのUnitかが判別できるようになっている。
|拡張子|機能|
|----|----|
|device|各種デバイスを管理する|
|mount|ファイルシステムのマウントを管理する|
|service|サービスを制御するUnit|
|swap|スワップ領域を管理する|
|target|複数のサービスを一つのグループにするためのUnit|

また、SysVinitではプロセスをPIDによって管理していましたが、systemdではcgroupsというLinuxカーネルの機能によってプロセスのリソースを管理できる。
systemdはUpstartと同様、各サービスを並列起動することができる。そのため、順次起動していくSysVisinitに比べて高速なシステム起動や停止が行える。
システム起動時に最初に読み込まれるUnitは/ect/systemd/system/default.target。
default.targetをSysVinitでのランレベルに相当するUnitへのシンボリックとして作成することで、期待するサービス群を起動できるようになる。

```
systemctl status httpd  #各サービスの稼働状況や起動せってを管理するにはsystemctlコマンド
```

```
journalctlコマンドのオプションでdmesgコマンドと同じ情報を得られるオプション
-k
--dmesg
```

systemdの動作するシステムではsystemd-journaldデーモンを動作させ、ログの一元管理を行う。system-journaldはsystemdから起動したプロセスの標準出力やsyslogへのログメッセージをバイナリ形式で記録する。
systemd-journakdが書き込むログファイルはバイナリ形式のため、catコマンドで中を見ることができない。
journalctlコマンドを使用する。
-kオプションまたは--dmesgオプションで、dmesgコマンドと同じ情報が出力される。

### USBのデバイスクラス

```
Mass Storage Class
```

USBデバイスはいくつかのデバイスクラス(種類)に分かれている。
それぞれのデバイスクラスにはクラスドライバという汎用ドライバが用意されている。
|デバイスクラス|デバイス|
|----|----|
|HID|キーボード、マウス、ジョイスティックなど|
|Mass Storage Class|ハードディスク、USBメモリーなど|
|ACM Communication Device Class|モデム、TAなど|
|Audio Class|スピーカー、マイク|

### システム再起動
今すぐシステムを再起動するコマンド

```
reboot
shutdown -r now
telinit 6
```
システムを再起動させる方法はいくつかある

- [ ] rebootコマンドの実行
- [ ] init 6またはtelinit 6コマンドを実行する。ランレベルを６に変更するとシステムが再起動
- [ ] shutdoenコマンドを使用する

shutdown [オプション] 時間 [メッセージ]

|オプション|説明|
|----|----|
|-h|システム停止|
|-r|システム再起動|
|-k|シャットダウンは行わず、ログイン中の前ユーザーにメッセージを送る|
|-c|実行中のシャットダウンをキャンセル|

### 大容量記憶装置

大量のデータのための記憶装置を「大容量記憶装置(mass storage device)」という。
OSをインストールして起動ディスクとして使用したり、大容量のデータを保管するために使用。

特徴
- SSDはSATAインターフェース以上の速度でアクセスできる
- SSDとUSBフラッシュドライブは、HDDのような機械な故障は起きない
- OSの起動ディスクとして使用できる
- 容量当たりのコスパが高いのはHDDである

主な大容量記憶装置

|装置|内容|
|----|----|
|HDD|容量が大きくコスパが高い記憶装置。データの記憶には磁気を使用。コンピュータに内蔵できるものと外付けできるものがある。装置内部の「プラッタ」という回転する円盤に対してデータの読み書きを行うので、衝撃によりプラッタに傷ついてデータが破損する場合もある。|
|USBフラッシュドライブ|USBメモリと呼ばれる記憶装置。内部の「フラッシュメモリ(不揮発性の半導体メモリ)」にデータの読み書きを行う。フラッシュメモリには書き換え回数やデータ保存期間に制限があり、長期保存には向いてない|
|SSD|ディスクという名前がついているが、記憶装置として半導体メモリを用いており、実際にはフラッシュメモリに属する機器。USBフラッシュメモリと同様に長期保存には向いてない。ランダムアクセス性能に優れており、省電力で静音、非接触メディアであるため耐振動・衝撃性が高く、近年ではHDDの代わりに使用されていることも多い。フラッシュメモリの高速性を引き出すため、SATAより高速な「NVMe」インターフェースで接続するタイプのもある。|

### IRQ
IRQに関する情報が格納されているファイル
```
/proc/interrupts
```
IRQ(Interrupt ReQuest)とは、マウスやキーボードなどの周辺機器(デバイス)からCPUへの割り込み要求のこと。IRQには０から1,2,3のように順位番号がつき、そのうちのいくつかは特定のデバイスに割り当てられる。

### ランレベル

|ランレベル|説明|
|----|----|
|0|システム停止|
|1/s/S|シングルユーザモード|
|2|マルチユーザモード(テキストログイン、NFSなし)|
|3|マルチユーザモード(テキストログイン)|
|4|未使用|
|5|マルチユーザモード(GUIログイン)|
|6|システム起動|


