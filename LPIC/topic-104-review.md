### パーティションとファイルシステムの作成

MBR形式のハードディスクにおいて、パーティションの作成、削除、変更及び情報表示を行うことできるコマンド
```
fdisk
```

ファイルシステムの作成コマンド
```
mkfs
```

ext2ファイルシステムを/dev/sda1に作成するコマンド
```
mkfs -t ext2 /dev/sda1
mke2fs /dev/sda1
mkfs /dev/hda1
```
mke2fsコマンドでext2/ext3/ext4ファイルシステムを作成できる
mkfsコマンドでは-tオプションで、ext2/ext3/ext4のみならず、xfs,jfsなどのファイルシステムをしてし作成できる
両方のコマンドとも、-tオプションをしてしない場合、デフォルトでext2ファイルシステムが作成される


### ファイルシステムのマウントとアンマウント

ext3ファイルシステムの/dev/sda1を/exportに読み取り専用でマウントしたい。
```
mount -t ext3 -o ro /dev/sda1 /export
```

mountコマンドの書式
mount [オプション] [マウントするデバイス名] [マウントポイント]

-tオプション 続けてファイルシステムの種類を指定
-oオプション 続けてマウントオプションを指定

現在マウントされているファイルシステムの情報が格納されているファイル
```
/etc/mtab
```

ファイルシステムのマウント設定を記載するファイル
```
/etc/fstab
```

/etc/fstabファイルでマウントオプションとしてdefaultsを指定した場合
```
async,auto,dev,exec,nouser,rw,suid
```

以下のコマンドを実行して/dev/sdb2を/dataにマウントした。/dev/sdb2を正しく(エラーの出ないように)アンマウントするコマンド
```
mount -t xfs /dev/sdb2 /data

umount /data
umount /dev/sdb2
umount -at xfs
```
書式
umount [オプション] [マウントされているデバイス名、またはマウントポイント]
/etc/mtabファイルには現在マウントされているファイルシステムの情報が格納されている
-at xfsオプションを指定すると、現在マウントされている(/etc/mtabファイルに記述されている)xfs形式のファイルシステムを全てマウントする

**muontコマンドはデバイス名またはマウントコマンドのどちらかをしてすれば良い**

現在マウントされているファイルシステムを確認するコマンド
```
mount
cat /proc/self/mounts
cat /proc/mounts
cat /etc/mtab
```
Linuxでは/procディレクトリの配下にさまざまなリソース情報がおさめられているが、/proc/self/mountsと/proc/mountsファイルにも現在マウントされているファイルシステムの情報が格納されている


### システムファイルの検索、適切なファイル配置

/var/logディレクトリとその配下にある、所有者がrootであるずべてのファイルとディレクトリを検索するコマンド
```
find /var/log -user 0
find /var/log -uid 0
finf /var/log -user root -print
```
rootは、ユーザIDが０、ユーザ名がrootのユーザなので、具体的には-uid 0,-user 0, -user rootで検索することができる

カレントディレクトリ以下から、アクセス権が775のディレクトリを検索できるコマンド
```
find . -type d -perm 775
```
-type ファイルの種類(d ディレクトリ,f ファイル, l シンボリックリンク)

findコマンドでファイルを検索する際、検索するディレクトリの階層数を指定するコマンド
```
-maxdepth   #指定した階層まで検索
-mindepth   #指定した階層から下を検索
```

cdコマンドの場所のパスを表示
```
which cp
whereis cp
```
指定したコマンドの場所を検索するにはwhichまたはwhereisコマンドを利用

whichコマンドは、環境変数PATHで設定しているディレクトリから検索
whereisコマンドは、Linuxでコマンドの格納されている標準的なしれクトリの中から検索する。
またマニュアル、ソースコードの場所も表示する。

### ファイルシステムの整合性の維持

dirディレクトリと、その配下にあるディレクトリ及びファイルが占めている容量をわかりやい単位で付加して表示するコマンド
```
du -ah dir
```

ファイルやディレクトリが占めている容量はduコマンド

-aオプション ディレクトリ以外にファイルについても表示
-hオプション わかりやすい単位

ext2ファイルシステムの/dev/hda5をext3に変換するコマンド
```
tune2fs -j /dev/hda5
```

ファイルシステムをext2からext3に変換するにはtune2fsコマンド
-jオプション ext2をext3ファイルシステムに変換

XFSファイルシステムをチェックするコマンド
```
xfs_check
```
XFSはシルコングラフィックス社が開発したジャーナリングファイルシステム

fsckコマンドでファイルシステムの整合性をチェックする際、障害箇所を対話的に修復したい。その際のオプション。
```
fsck -r
```
fsckコマンドはファイルシステムのチェック、及び問題を修復することができる
-rオプション 問題を対話的に修復

### ハードリンクとシンボリックリンクの作成・変更

/home/testディレクトのハードリンクを/home/testlinkという名で作成したい
```
ディレクトリのハードリンクは作成できない
```
循環ディレクトリの作成を防ぐため、ディレクトリのハードリンクは作成できない
ディレクトリのシンボリックであれば作成できる

作成したリンクがハードリンクかシンボリックリンクかを確認するコマンド
```
ls -l
ls -i
```
### ファイルのパーミッションと所有権の管理

file.txtの所有グループのみをtestからstaffgroupに変更するコマンド
```
chgrp staffgroup file.txt
chown .staffgroup file.txt
chown :staffgroup file.txt
```

chownコマンド 指定したファイルまたはディレクトリの所有ユーザや所有グループを変更する(所有ユーザを変更できるのはrootユーザのみ)
chgrpコマンド 所有グループのみを変更可能(ユーザが所属しているグループであれば一般ユーザでも変更できる)

書式
chown [-R] :グループ名 ファイルまたはディレクトリ 
:の部分は.としても同じ
chgrp [-R] グループ名 ファイルまたはディレクトリ

ファイルやディレクトリのパーミッションを変更するコマンド
```
chmod
```

プログラムfileをどのユーザが実行しても、プログラムの所有者の権限で実行させたい時のコマンド。なお、fileのパーミッションは755である。
```
chmod 4755 file
chmod u+s file
```

プログラムをどのユーザが実行しても、プログラムの所有ユーザ権限で実行されるようにするにはSUIDを設定する。設定方法は、chmodコマンドで通常のパーミッションの値に4000を加えた値に設定するか、所有ユーザにsという権限をつけて追加(u+s)

例えば、Linuxではpasswdコマンド(プログラム)にSUIDが設定されている
passwdコマンドは一般ユーザがパスワードを変更する際などに使用される
このコマンドはユーザアカウントの変更情報を/etc/passwdファイルに書き込む
しかし、/etc/passwdファイルのパーミッションは、以下のように所有者はrootユーザであり、rootユーザ以外は読み取りの許可のみで、書き込みができないようになっている。
```
-rw-r--r--. 1 root root 2170 3月 14 21:19 2012 /etc/passwd
```
そこでpasswdコマンドにはSUIDを設定することで、一般ユーザがroot権限で自身のアカウント情報を変更する(/etc/passwdファイルに書き込むことができる)

ファイルやディレクトリを新規作成した際の、デフォルトのパーミッションを調整するコマンド
```
umask
```
新規に作成されるファイルやディレクトリのデフォルトのポーミッションは、システムのパーミッション初期値を基本とし、それをumask値(初期値から削除する権限の設定)で調整して決定される。
umask値を確認または一時変更したい場合、対象ユーザとしてログインしてumaskコマンドを使用する


シンボリックそのもののパーミッションは変更されず、リンク元のファイルのパーミッションが変更される
