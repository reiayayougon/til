### ファイルシステムの整合性の維持

XFSファイルシステムのデフラグを行うコマンド
```
xfs_fsr    #ファイルシステムのデフラグを行う
```

XFSは、シリコングラフィック(SGI)が開発したジャーナリングファイルシステム。

XFSは設計上、ファイルの作成や削除を繰り返すうちにハードディスク上の連続した領域が少なくなり、
データが分散されて保存される断片化(フラグメンテーション)が発生することがある
断片化が多くなるとデータの読み書きのパフォーマンスが低下するため、デフラグを行って断片化を解消する

dirディレクトリと、その配下にあるディレクトリ及びファイルが占めている容量を、分かりやすい単位を付加して表示するコマンド

```
du -ah dir
```

duコマンドは、ファイルやディレクトリが占めている容量を確認する
duコマンドオプション

|オプション|説明|
|----|----|
|-a|ディレクトリ以外にファイルについても表示|
|-h|分かりやすい単位を付加して表示|
|-c|合計容量同時に表示|
|-s|指定したファイルやディレクトリの合計のみ表示|
|-S|ディレクトリの容量にサブディレクトリの容量を含めず表示|
|-k|キロバイト単表示|
|-m|メガバイト表示|

fsckコマンドは、ファイルシステムのチャック、及び問題を修復することができる
fsckコマンドオプション

|オプション|説明|
|-t|ファイルシステムの種類を指定|
|-A|/etc/fstabに記述されている全ファイルシステムに対して実行|
|-N|実際には実行せずに、実行する内容を表示|
|-a|問題を自動的に表示|
|-r|問題を対話的に表示|

fsckコマンドでext3ファイルシステムの/dev/sda4の整合性チェックする際、実際には実行せず、何が行われるかのみを表示するコマンド
```
fsck -N -t ext3 /dev/sda4
```

e2fsckコマンドで/dev/sda4をチェックする際、全ての問題を自動的に修復するコマンド
```
e2fsck -p /dev/sda4
```
e2fsckコマンドは、ext2/ext3/ext4ファイルシステムのチェック、および問題を修復することができる

e3fsckコマンドオプション

|オプション|説明|
|----|----|
|-y|全ての問い合わせに対し、自動的にyesと回答|
|-n|全ての問い合わせに対し、自動的にno回答|
|-p|全ての問題を自動的に修復|

### パーティションとファイルシステムの作成

MBR形式のハードディスクである/dev/sdaデバイスのパーティションを操作するコマンド
```
fdisk -n /dev/sda
```

fdiskコマンドで、MBR形式のハードディスクに対してパーティションの作成、削除、変更及び情報表示を行うことができる。
「-l」オプションを指定せずに実行すると、指定したデバイスのパーティションを対話的に操作することができる

MBR形式とGPT形式の違い

どちらもディスク上でパーティションを管理する方法
MBRは小さいディスクや古いシステムで使われ、GPTは大きなディスクや新しいシステムで使われる

MBR形式
- 制限:小さいディスクで問題なく動作、大容量のディスクには対応しない
- パーティション数:最大４つのパーティションしか作成できない。ただし、その中の一つを拡張して複数の論理パーティションを作ることこもできる
- ブート:ブートローダーがディスクの最初の部分にあり、システムの起動情報を管理する

GPT形式
- ディスクサイズ:大きなディスクにも対応
- パーティション数:理論的にほぼ無制限のパーティションを作成
- 信頼性:エラーの検出機能があり、データの整合性を保つ
- UEFI:新しいコンピュータではよく使われるUEFIブートに対応している

GTPに存在しない制約
- 基本パーティション数：４
- 起動用システムファームウエア：BIOS
- 最大ハードディスク容量：2.2TB(2TiB)

GPT形式のハードディスクにおいて、パーティションの作成、削除、変更及び情報の表示行うコマンド
```
gdisk
```

fdiskコマンドでMBR形式のハードディスクに対してパーティションの作成、削除、変更及び情報表示を行う
fdiskコマンドのサブコマンドとその説明

|サブコマンド|説明|
|----|----|
|p|パーティションテーブルの表示|
|t|パーティションタイプ(システムID)の変更|
|m|サブコマンドメニュー表示|
|l|パーティションタイプの一覧表示|
|n|パーティション作成|
|d|パーティション削除|
|w|パーティションテーブルの変更を保存して終了|
|q|パーティションテーブルの変更を保存せずに終了|

パーティションタイプ

|82|Linuxスワップパーティション|
|----|----|
|8e|Linux LVM・パーティション|
|83|Linuxデータパーティション|


exFATファイルシステムの特徴
- フラッシュドライブ向けのファイルシステム
- 4GiB以上の大容量のファイルを扱える

exFATは、USBメモリのようなフラッシュドライブ向けのファイルシステムである

fdiskコマンドで作成したパーティションにファイルシステムを作成することができるコマンド
```
mke2fs
mkfs
```

fdiskコマンドで作成したパーティションを利用するには、パーティションにファイルシステムを作成する必要がある。
パーティションにファイルシステムを作成することで、ファイルを単位としたデータの管理が行えるようになる

mke2fsコマンド  ext2/ext3/ext4ファイルシステムを作成できる
mkfsコマンド   -tオプションでext2/ext3/ext4のみならずxfs,jfsなどのファイルシステムを指定し作成

mkfsコマンドまたはmke2fsコマンドでファイルシステムを作成する際、不良ブロックがないか検査をしてから作成するオプション

```
mkfs -t ext3 -c /dev/sda2
mke2fs -j -c /dev/sda2
```
-c ファイルを作成する前に不良ブロックを検査

mkswap  スワップ領域を作成するコマンド
スワップ領域とは、物理メモリ(実メモリ)に収まらなかった情報を一時的に格納するための、通常ハードディスク上に作成する領域

swpapon スワップ領域を有効にするコマンド
swapoff スワップ領域を無効にするコマンド
fdisk スワップ用のパーティションを作成する際に使用。スワップ領域の作成までは行えない

inodeの数が制限されるファイルシステム
```
ext2
ext3
ext4
```

inodeの数が制限されるファイルシステムは、動的inodeの機能がないファイルシステム
inodeとは、Linuxファイルシステムにおいてファイルの属性(パーミッションや所有ユーザなどの情報)を格納するもの。全てのファイルシステムには対応するinode番号がある
動的inode機能とは、ファイル作成時にinode番号を動的に割り当てる機能のこと。
inodeを動的に割り当てるため、inodeの数に制限はない
動的にinode機能がないファイルシステムでは、inodeはファイルシステム作成時に作成され増やすことはできない。そのため、ファイルの数が増えるなどして使用なinodeがなくなると、ディスクに空き容量があってもファイルを新規に作成することができなくなる。
